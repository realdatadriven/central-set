import{S as SvelteComponent,i as init,s as safe_not_equal,v as ensure_array_like,I as Icons,e as element,t as text,a as space,c as create_component,w as empty,b as attr,d as insert,f as append,C as set_input_value,m as mount_component,l as listen,n as set_data,g as transition_in,h as group_outros,k as check_outros,j as transition_out,o as detach,x as destroy_each,p as destroy_component,D as run_all,q as component_subscribe,_ as _global,r as i18n,u as onMount,F as hooks,y as lodashExports,B as set_style,L as Loadingv2,T as Toast,H as assign,M as Modal,J as get_spread_update,K as get_spread_object,O as get_tables,$ as select_value,a0 as add_render_callback,a1 as select_option,U as noop,ac as save_table_schema,z as string_ellipsis,A as string_ellipsis_title}from"./index-13d4ac78.js";import"./pt-607305e9.js";import{P as Pagination}from"./Pagination-a0736574.js";function get_each_context(e,t,l){const n=e.slice();return n[58]=t[l],n[59]=t,n[60]=l,n}function get_each_context_1(e,t,l){const n=e.slice();return n[61]=t[l],n}function get_each_context_2(e,t,l){const n=e.slice();return n[64]=t[l],n[65]=t,n[66]=l,n}function get_each_context_3(e,t,l){const n=e.slice();return n[58]=t[l],n[67]=t,n[60]=l,n}function get_each_context_4(e,t,l){const n=e.slice();return n[61]=t[l],n}function get_each_context_5(e,t,l){const n=e.slice();return n[58]=t[l],n}function create_each_block_5(e){var s,a;let t,l=(((a=(s=e[14])==null?void 0:s[e[58]])==null?void 0:a.label)||e[13].t(`crud.${e[58]}`))+"",n;return{c(){var i,o;t=element("th"),n=text(l),attr(t,"class","normal-case "+(((o=(i=e[14])==null?void 0:i[e[58]])==null?void 0:o.width)||""))},m(i,o){insert(i,t,o),append(t,n)},p(i,o){var p,c;o[0]&8192&&l!==(l=(((c=(p=i[14])==null?void 0:p[i[58]])==null?void 0:c.label)||i[13].t(`crud.${i[58]}`))+"")&&set_data(n,l)},d(i){i&&detach(t)}}}function create_else_block(e){let t,l,n,s,a,i;function o(){e[30].call(l,e[58],e[65],e[66])}function p(...c){return e[31](e[64],...c)}return{c(){var c,m;t=element("td"),l=element("input"),attr(l,"type","text"),attr(l,"class",n="input input-sm w-full bg-transparent "+(e[64]._edited?"text-warning":"")+" "+(e[64]._added?"text-success":"")),l.disabled=s=e[64].id_field,attr(t,"class","p-0.5 "+(((m=(c=e[14])==null?void 0:c[e[58]])==null?void 0:m.width)||""))},m(c,m){insert(c,t,m),append(t,l),set_input_value(l,e[64][e[58]]),a||(i=[listen(l,"input",o),listen(l,"change",p)],a=!0)},p(c,m){e=c,m[0]&17948&&n!==(n="input input-sm w-full bg-transparent "+(e[64]._edited?"text-warning":"")+" "+(e[64]._added?"text-success":""))&&attr(l,"class",n),m[0]&17948&&s!==(s=e[64].id_field)&&(l.disabled=s),m[0]&17948&&l.value!==e[64][e[58]]&&set_input_value(l,e[64][e[58]])},d(c){c&&detach(t),a=!1,run_all(i)}}}function create_if_block_8(e){var r,v;let t,l,n,s,a,i,o=ensure_array_like(((v=(r=e[14])==null?void 0:r[e[58]])==null?void 0:v.options)||[]),p=[];for(let u=0;u<o.length;u+=1)p[u]=create_each_block_4(get_each_context_4(e,o,u));function c(){e[28].call(l,e[58],e[65],e[66])}function m(...u){return e[29](e[64],...u)}return{c(){var u,b,$,w;t=element("td"),l=element("select");for(let j=0;j<p.length;j+=1)p[j].c();attr(l,"class",n="select select-sm p-0.5 "+(((b=(u=e[14])==null?void 0:u[e[58]])==null?void 0:b.width)||"w-full")+" "+(e[64]._edited?"text-warning":"")+" "+(e[64]._added?"text-success":"")+" bg-transparent"),l.disabled=s=e[64].id_field,e[64][e[58]]===void 0&&add_render_callback(c),attr(t,"class","p-0.5 "+(((w=($=e[14])==null?void 0:$[e[58]])==null?void 0:w.width)||""))},m(u,b){insert(u,t,b),append(t,l);for(let $=0;$<p.length;$+=1)p[$]&&p[$].m(l,null);select_option(l,e[64][e[58]],!0),a||(i=[listen(l,"change",c),listen(l,"change",m)],a=!0)},p(u,b){var $,w,j,B;if(e=u,b[0]&16384){o=ensure_array_like(((w=($=e[14])==null?void 0:$[e[58]])==null?void 0:w.options)||[]);let C;for(C=0;C<o.length;C+=1){const U=get_each_context_4(e,o,C);p[C]?p[C].p(U,b):(p[C]=create_each_block_4(U),p[C].c(),p[C].m(l,null))}for(;C<p.length;C+=1)p[C].d(1);p.length=o.length}b[0]&17948&&n!==(n="select select-sm p-0.5 "+(((B=(j=e[14])==null?void 0:j[e[58]])==null?void 0:B.width)||"w-full")+" "+(e[64]._edited?"text-warning":"")+" "+(e[64]._added?"text-success":"")+" bg-transparent")&&attr(l,"class",n),b[0]&17948&&s!==(s=e[64].id_field)&&(l.disabled=s),b[0]&17948&&select_option(l,e[64][e[58]])},d(u){u&&detach(t),destroy_each(p,u),a=!1,run_all(i)}}}function create_if_block_7(e){let t,l,n,s,a,i;function o(){e[26].call(l,e[58],e[65],e[66])}function p(...c){return e[27](e[64],...c)}return{c(){var c,m;t=element("td"),l=element("input"),attr(l,"type","checkbox"),attr(l,"class","checkbox checkbox-sm"),l.disabled=n=e[64].id_field,attr(t,"class",s="p-0 text-center "+(((m=(c=e[14])==null?void 0:c[e[58]])==null?void 0:m.width)||"")+" "+(e[64]._edited?"text-warning":"")+" "+(e[64]._added?"text-success":""))},m(c,m){insert(c,t,m),append(t,l),l.checked=e[64][e[58]],a||(i=[listen(l,"change",o),listen(l,"change",p)],a=!0)},p(c,m){var r,v;e=c,m[0]&17948&&n!==(n=e[64].id_field)&&(l.disabled=n),m[0]&17948&&(l.checked=e[64][e[58]]),m[0]&17948&&s!==(s="p-0 text-center "+(((v=(r=e[14])==null?void 0:r[e[58]])==null?void 0:v.width)||"")+" "+(e[64]._edited?"text-warning":"")+" "+(e[64]._added?"text-success":""))&&attr(t,"class",s)},d(c){c&&detach(t),a=!1,run_all(i)}}}function create_if_block_6(e){let t,l,n=string_ellipsis(e[64][e[58]],30)+"",s,a;return{c(){var i,o;t=element("td"),l=element("span"),s=text(n),attr(l,"title",a=string_ellipsis_title(e[64][e[58]],30)),attr(t,"class","normal-case "+(((o=(i=e[14])==null?void 0:i[e[58]])==null?void 0:o.width)||""))},m(i,o){insert(i,t,o),append(t,l),append(l,s)},p(i,o){o[0]&1564&&n!==(n=string_ellipsis(i[64][i[58]],30)+"")&&set_data(s,n),o[0]&17948&&a!==(a=string_ellipsis_title(i[64][i[58]],30))&&attr(l,"title",a)},d(i){i&&detach(t)}}}function create_each_block_4(e){let t,l=e[61].label+"",n;return{c(){t=element("option"),n=text(l),t.__value=e[61].value,set_input_value(t,t.__value)},m(s,a){insert(s,t,a),append(t,n)},p:noop,d(s){s&&detach(t)}}}function create_each_block_3(e){let t;function l(a,i){var o,p,c,m,r,v;return((p=(o=a[14])==null?void 0:o[a[58]])==null?void 0:p.editable)!==!0?create_if_block_6:((m=(c=a[14])==null?void 0:c[a[58]])==null?void 0:m.type)==="boolean"?create_if_block_7:((v=(r=a[14])==null?void 0:r[a[58]])==null?void 0:v.type)==="select"?create_if_block_8:create_else_block}let s=l(e)(e);return{c(){s.c(),t=empty()},m(a,i){s.m(a,i),insert(a,t,i)},p(a,i){s.p(a,i)},d(a){a&&detach(t),s.d(a)}}}function create_each_block_2(e){let t,l,n,s,a,i,o,p,c,m,r,v,u,b,$,w,j,B,C,U,g,q,z,M=ensure_array_like(Object.keys(e[14])),k=[];for(let y=0;y<M.length;y+=1)k[y]=create_each_block_3(get_each_context_3(e,M,y));i=new Icons({props:{type:"outline",icon:"trash",path:"icons"}});function V(){return e[32](e[64],e[65],e[66])}v=new Icons({props:{type:"outline",icon:"arrow-down",path:"icons"}});function R(){return e[33](e[64])}B=new Icons({props:{type:"outline",icon:"arrow-up",path:"icons"}});function te(){return e[34](e[64])}return{c(){t=element("tr");for(let y=0;y<k.length;y+=1)k[y].c();l=space(),n=element("td"),s=element("button"),a=element("span"),create_component(i.$$.fragment),p=space(),c=element("td"),m=element("button"),r=element("span"),create_component(v.$$.fragment),b=space(),$=element("td"),w=element("button"),j=element("span"),create_component(B.$$.fragment),U=space(),attr(a,"class","w-6"),attr(s,"class","btn btn-circle btn-ghost btn-sm m-0 text-xs"),s.disabled=o=e[64].id_field,attr(n,"class","p-0 w-16 text-right"),attr(r,"class","w-6"),attr(m,"class","btn btn-circle btn-ghost btn-sm m-0 text-xs"),m.disabled=u=e[64].id_field||e[64].tail_field,attr(c,"class","p-0 w-16 text-right"),attr(j,"class","w-6"),attr(w,"class","btn btn-circle btn-ghost btn-sm m-0 text-xs"),w.disabled=C=e[64].id_field||e[64].tail_field,attr($,"class","p-0 w-16 text-right"),set_style(t,"display",e[64]._remove===!0?"none":"")},m(y,P){insert(y,t,P);for(let T=0;T<k.length;T+=1)k[T]&&k[T].m(t,null);append(t,l),append(t,n),append(n,s),append(s,a),mount_component(i,a,null),append(t,p),append(t,c),append(c,m),append(m,r),mount_component(v,r,null),append(t,b),append(t,$),append($,w),append(w,j),mount_component(B,j,null),append(t,U),g=!0,q||(z=[listen(s,"click",V),listen(m,"click",R),listen(w,"click",te)],q=!0)},p(y,P){if(e=y,P[0]&280092){M=ensure_array_like(Object.keys(e[14]));let T;for(T=0;T<M.length;T+=1){const Y=get_each_context_3(e,M,T);k[T]?k[T].p(Y,P):(k[T]=create_each_block_3(Y),k[T].c(),k[T].m(t,l))}for(;T<k.length;T+=1)k[T].d(1);k.length=M.length}(!g||P[0]&17948&&o!==(o=e[64].id_field))&&(s.disabled=o),(!g||P[0]&17948&&u!==(u=e[64].id_field||e[64].tail_field))&&(m.disabled=u),(!g||P[0]&17948&&C!==(C=e[64].id_field||e[64].tail_field))&&(w.disabled=C),P[0]&1564&&set_style(t,"display",e[64]._remove===!0?"none":"")},i(y){g||(transition_in(i.$$.fragment,y),transition_in(v.$$.fragment,y),transition_in(B.$$.fragment,y),g=!0)},o(y){transition_out(i.$$.fragment,y),transition_out(v.$$.fragment,y),transition_out(B.$$.fragment,y),g=!1},d(y){y&&detach(t),destroy_each(k,y),destroy_component(i),destroy_component(v),destroy_component(B),q=!1,run_all(z)}}}function create_if_block_5(e){var c,m;let t,l,n,s,a=ensure_array_like(((m=(c=e[14])==null?void 0:c[e[58]])==null?void 0:m.options)||[]),i=[];for(let r=0;r<a.length;r+=1)i[r]=create_each_block_1(get_each_context_1(e,a,r));function o(){e[37].call(t,e[58])}function p(){return e[38](e[58])}return{c(){var r,v;t=element("select"),l=element("option");for(let u=0;u<i.length;u+=1)i[u].c();l.__value="",set_input_value(l,l.__value),attr(t,"class","select select-sm p-0.5 w-full bg-transparent"),t.disabled=e[16]((v=(r=e[14])==null?void 0:r[e[58]])==null?void 0:v.disabled,e[58]),e[7][e[58]]===void 0&&add_render_callback(o)},m(r,v){insert(r,t,v),append(t,l);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(t,null);select_option(t,e[7][e[58]],!0),n||(s=[listen(t,"change",o),listen(t,"change",p)],n=!0)},p(r,v){var u,b;if(e=r,v[0]&16384){a=ensure_array_like(((b=(u=e[14])==null?void 0:u[e[58]])==null?void 0:b.options)||[]);let $;for($=0;$<a.length;$+=1){const w=get_each_context_1(e,a,$);i[$]?i[$].p(w,v):(i[$]=create_each_block_1(w),i[$].c(),i[$].m(t,null))}for(;$<i.length;$+=1)i[$].d(1);i.length=a.length}v[0]&16512&&select_option(t,e[7][e[58]])},d(r){r&&detach(t),destroy_each(i,r),n=!1,run_all(s)}}}function create_if_block_4(e){let t,l,n;function s(){e[36].call(t,e[58])}return{c(){var a,i,o,p;t=element("input"),attr(t,"type","text"),attr(t,"class","input input-sm "+(((i=(a=e[14])==null?void 0:a[e[58]])==null?void 0:i.width)||"w-full")+" bg-transparent"),t.disabled=e[16]((p=(o=e[14])==null?void 0:o[e[58]])==null?void 0:p.disabled,e[58])},m(a,i){insert(a,t,i),set_input_value(t,e[7][e[58]]),l||(n=listen(t,"input",s),l=!0)},p(a,i){e=a,i[0]&16512&&t.value!==e[7][e[58]]&&set_input_value(t,e[7][e[58]])},d(a){a&&detach(t),l=!1,n()}}}function create_if_block_3(e){let t,l,n;function s(){e[35].call(t,e[58])}return{c(){var a,i;t=element("input"),attr(t,"type","checkbox"),attr(t,"class","checkbox checkbox-sm"),t.disabled=e[16]((i=(a=e[14])==null?void 0:a[e[58]])==null?void 0:i.disabled,e[58])},m(a,i){insert(a,t,i),t.checked=e[7][e[58]],l||(n=listen(t,"change",s),l=!0)},p(a,i){e=a,i[0]&16512&&(t.checked=e[7][e[58]])},d(a){a&&detach(t),l=!1,n()}}}function create_each_block_1(e){let t,l=e[61].label+"",n;return{c(){t=element("option"),n=text(l),t.__value=e[61].value,set_input_value(t,t.__value)},m(s,a){insert(s,t,a),append(t,n)},p:noop,d(s){s&&detach(t)}}}function create_each_block(e){let t;function l(a,i){var o,p,c,m,r,v;if(["boolean"].includes((p=(o=a[14])==null?void 0:o[a[58]])==null?void 0:p.type))return create_if_block_3;if(["string"].includes((m=(c=a[14])==null?void 0:c[a[58]])==null?void 0:m.type))return create_if_block_4;if(["select"].includes((v=(r=a[14])==null?void 0:r[a[58]])==null?void 0:v.type))return create_if_block_5}let n=l(e),s=n&&n(e);return{c(){var a,i,o,p;t=element("td"),s&&s.c(),attr(t,"class",(((i=(a=e[14])==null?void 0:a[e[58]])==null?void 0:i.width)||"")+" "+(((p=(o=e[14])==null?void 0:o[e[58]])==null?void 0:p.type)==="boolean"?"text-center":""))},m(a,i){insert(a,t,i),s&&s.m(t,null)},p(a,i){s&&s.p(a,i)},d(a){a&&detach(t),s&&s.d()}}}function create_if_block_2(e){let t,l;return t=new Loadingv2({props:{open:e[11]}}),{c(){create_component(t.$$.fragment)},m(n,s){mount_component(t,n,s),l=!0},p(n,s){const a={};s[0]&2048&&(a.open=n[11]),t.$set(a)},i(n){l||(transition_in(t.$$.fragment,n),l=!0)},o(n){transition_out(t.$$.fragment,n),l=!1},d(n){destroy_component(t,n)}}}function create_if_block_1(e){let t,l;return t=new Toast({props:{open:e[5].open,type:e[5].type,msg:e[5].msg,timer:2e4}}),t.$on("dismiss",e[41]),{c(){create_component(t.$$.fragment)},m(n,s){mount_component(t,n,s),l=!0},p(n,s){const a={};s[0]&32&&(a.open=n[5].open),s[0]&32&&(a.type=n[5].type),s[0]&32&&(a.msg=n[5].msg),t.$set(a)},i(n){l||(transition_in(t.$$.fragment,n),l=!0)},o(n){transition_out(t.$$.fragment,n),l=!1},d(n){destroy_component(t,n)}}}function create_if_block(e){let t,l;const n=[e[6]];let s={};for(let a=0;a<n.length;a+=1)s=assign(s,n[a]);return t=new Modal({props:s}),t.$on("dismiss",e[42]),{c(){create_component(t.$$.fragment)},m(a,i){mount_component(t,a,i),l=!0},p(a,i){const o=i[0]&64?get_spread_update(n,[get_spread_object(a[6])]):{};t.$set(o)},i(a){l||(transition_in(t.$$.fragment,a),l=!0)},o(a){transition_out(t.$$.fragment,a),l=!1},d(a){destroy_component(t,a)}}}function create_fragment(e){var ve,ke;let t,l,n,s,a,i,o=e[13].t("crud.name")+"",p,c,m,r,v,u,b,$,w,j=e[13].t("crud.label")+"",B,C,U,g,q,z,M,k,V,R,te,y=e[13].t("crud.replace_if_exists")+"",P,T,Y,F,re,W,ce,ie,be,se,he,pe,X,ue,_e,G,oe,Z,de,$e,H,me,ae,le,ne,J,fe,ge,x=ensure_array_like(Object.keys(e[14])),S=[];for(let _=0;_<x.length;_+=1)S[_]=create_each_block_5(get_each_context_5(e,x,_));let Q=ensure_array_like([e[9],...e[4],...e[10]].slice(e[3]*e[2],e[3]*e[2]+e[2])),I=[];for(let _=0;_<Q.length;_+=1)I[_]=create_each_block_2(get_each_context_2(e,Q,_));const Ce=_=>transition_out(I[_],1,1,()=>{I[_]=null});let ee=ensure_array_like(Object.keys(e[14])),A=[];for(let _=0;_<ee.length;_+=1)A[_]=create_each_block(get_each_context(e,ee,_));Z=new Icons({props:{type:"outline",icon:"plus",path:"icons"}}),H=new Pagination({props:{lang:(ve=e[12])==null?void 0:ve.lang,conf:(ke=e[12])==null?void 0:ke.conf,rows_per_page:e[2]||10,page:e[3]||0,total_rows:[e[9],...e[4],...e[10]].length}}),H.$on("pageChange",e[40]);let E=e[11]&&create_if_block_2(e),L=e[5].open&&create_if_block_1(e),O=e[6].open&&create_if_block(e);return{c(){var _,f,D;t=element("div"),l=element("div"),n=element("div"),s=element("label"),a=element("span"),i=element("b"),p=text(o),c=text(":"),m=space(),r=element("input"),v=space(),u=element("div"),b=element("label"),$=element("span"),w=element("b"),B=text(j),C=text(":"),U=space(),g=element("input"),q=space(),z=element("div"),M=element("label"),k=element("input"),V=space(),R=element("span"),te=element("b"),P=text(y),T=space(),Y=element("div"),F=element("table"),re=element("thead"),W=element("tr");for(let N=0;N<S.length;N+=1)S[N].c();ce=space(),ie=element("th"),be=space(),se=element("tbody");for(let N=0;N<I.length;N+=1)I[N].c();he=space(),pe=element("tfoot"),X=element("tr");for(let N=0;N<A.length;N+=1)A[N].c();ue=space(),_e=element("td"),G=element("button"),oe=element("span"),create_component(Z.$$.fragment),$e=space(),create_component(H.$$.fragment),me=space(),E&&E.c(),ae=space(),L&&L.c(),le=space(),O&&O.c(),ne=empty(),attr(a,"class","label-text pt-0"),attr(s,"class","label pt-0"),attr(s,"for","_name"),attr(r,"type","text"),attr(r,"id","_name"),attr(r,"name","_name"),attr(r,"placeholder",""),attr(r,"class","input input-bordered w-full input-sm"),attr(r,"autocomplete","off"),attr(r,"autocorrect","off"),attr(n,"class","form-control w-[20%] pr-2 mt-0"),attr($,"class","label-text pt-0"),attr(b,"class","label pt-0"),attr(b,"for","_comment"),attr(g,"type","text"),attr(g,"id","_comment"),attr(g,"name","_comment"),attr(g,"placeholder",""),attr(g,"class","input input-bordered w-full input-sm"),attr(g,"autocomplete","off"),attr(g,"autocorrect","off"),attr(u,"class","form-control w-[30%] pr-2 mt-0"),attr(k,"type","checkbox"),attr(k,"id","_replace"),attr(k,"name","_replace"),attr(k,"placeholder",""),attr(k,"class","checkbox checkbox-sm mr-2"),attr(k,"autocomplete","off"),attr(k,"autocorrect","off"),attr(R,"class","label-text"),attr(M,"class","label"),attr(M,"for","_replace"),attr(z,"class","form-control w-auto pr-2 mt-0 justify-end"),attr(l,"class","w-full flex flex-row p-1"),attr(ie,"class","p-0.5 w-16"),attr(ie,"colspan",3),attr(oe,"class","w-6"),attr(G,"class","btn btn-circle btn-ghost btn-sm m-0 text-xs"),G.disabled=de=!((_=e[7])!=null&&_.name)||!((f=e[7])!=null&&f.type)||!((D=e[7])!=null&&D.comment),attr(_e,"class","p-0.5 w-16 text-right"),attr(F,"class","table table-zebra w-[98%] normal-case table-xs"),attr(Y,"class","w-full overflow-x-auto"),attr(t,"class","--flex --flex-col")},m(_,f){insert(_,t,f),append(t,l),append(l,n),append(n,s),append(s,a),append(a,i),append(i,p),append(i,c),append(n,m),append(n,r),set_input_value(r,e[8].name),append(l,v),append(l,u),append(u,b),append(b,$),append($,w),append(w,B),append(w,C),append(u,U),append(u,g),set_input_value(g,e[8].comment),append(l,q),append(l,z),append(z,M),append(M,k),k.checked=e[8].replace,append(M,V),append(M,R),append(R,te),append(te,P),append(t,T),append(t,Y),append(Y,F),append(F,re),append(re,W);for(let D=0;D<S.length;D+=1)S[D]&&S[D].m(W,null);append(W,ce),append(W,ie),append(F,be),append(F,se);for(let D=0;D<I.length;D+=1)I[D]&&I[D].m(se,null);append(F,he),append(F,pe),append(pe,X);for(let D=0;D<A.length;D+=1)A[D]&&A[D].m(X,null);append(X,ue),append(X,_e),append(_e,G),append(G,oe),mount_component(Z,oe,null),append(t,$e),mount_component(H,t,null),insert(_,me,f),E&&E.m(_,f),insert(_,ae,f),L&&L.m(_,f),insert(_,le,f),O&&O.m(_,f),insert(_,ne,f),J=!0,fe||(ge=[listen(r,"input",e[22]),listen(r,"change",e[23]),listen(g,"input",e[24]),listen(k,"change",e[25]),listen(G,"click",e[39])],fe=!0)},p(_,f){var N,ye,we,qe,De;if((!J||f[0]&8192)&&o!==(o=_[13].t("crud.name")+"")&&set_data(p,o),f[0]&256&&r.value!==_[8].name&&set_input_value(r,_[8].name),(!J||f[0]&8192)&&j!==(j=_[13].t("crud.label")+"")&&set_data(B,j),f[0]&256&&g.value!==_[8].comment&&set_input_value(g,_[8].comment),f[0]&256&&(k.checked=_[8].replace),(!J||f[0]&8192)&&y!==(y=_[13].t("crud.replace_if_exists")+"")&&set_data(P,y),f[0]&24576){x=ensure_array_like(Object.keys(_[14]));let h;for(h=0;h<x.length;h+=1){const K=get_each_context_5(_,x,h);S[h]?S[h].p(K,f):(S[h]=create_each_block_5(K),S[h].c(),S[h].m(W,ce))}for(;h<S.length;h+=1)S[h].d(1);S.length=x.length}if(f[0]&280092){Q=ensure_array_like([_[9],..._[4],..._[10]].slice(_[3]*_[2],_[3]*_[2]+_[2]));let h;for(h=0;h<Q.length;h+=1){const K=get_each_context_2(_,Q,h);I[h]?(I[h].p(K,f),transition_in(I[h],1)):(I[h]=create_each_block_2(K),I[h].c(),transition_in(I[h],1),I[h].m(se,null))}for(group_outros(),h=Q.length;h<I.length;h+=1)Ce(h);check_outros()}if(f[0]&82050){ee=ensure_array_like(Object.keys(_[14]));let h;for(h=0;h<ee.length;h+=1){const K=get_each_context(_,ee,h);A[h]?A[h].p(K,f):(A[h]=create_each_block(K),A[h].c(),A[h].m(X,ue))}for(;h<A.length;h+=1)A[h].d(1);A.length=ee.length}(!J||f[0]&16512&&de!==(de=!((N=_[7])!=null&&N.name)||!((ye=_[7])!=null&&ye.type)||!((we=_[7])!=null&&we.comment)))&&(G.disabled=de);const D={};f[0]&4096&&(D.lang=(qe=_[12])==null?void 0:qe.lang),f[0]&4096&&(D.conf=(De=_[12])==null?void 0:De.conf),f[0]&4&&(D.rows_per_page=_[2]||10),f[0]&8&&(D.page=_[3]||0),f[0]&1552&&(D.total_rows=[_[9],..._[4],..._[10]].length),H.$set(D),_[11]?E?(E.p(_,f),f[0]&2048&&transition_in(E,1)):(E=create_if_block_2(_),E.c(),transition_in(E,1),E.m(ae.parentNode,ae)):E&&(group_outros(),transition_out(E,1,1,()=>{E=null}),check_outros()),_[5].open?L?(L.p(_,f),f[0]&32&&transition_in(L,1)):(L=create_if_block_1(_),L.c(),transition_in(L,1),L.m(le.parentNode,le)):L&&(group_outros(),transition_out(L,1,1,()=>{L=null}),check_outros()),_[6].open?O?(O.p(_,f),f[0]&64&&transition_in(O,1)):(O=create_if_block(_),O.c(),transition_in(O,1),O.m(ne.parentNode,ne)):O&&(group_outros(),transition_out(O,1,1,()=>{O=null}),check_outros())},i(_){if(!J){for(let f=0;f<Q.length;f+=1)transition_in(I[f]);transition_in(Z.$$.fragment,_),transition_in(H.$$.fragment,_),transition_in(E),transition_in(L),transition_in(O),J=!0}},o(_){I=I.filter(Boolean);for(let f=0;f<I.length;f+=1)transition_out(I[f]);transition_out(Z.$$.fragment,_),transition_out(H.$$.fragment,_),transition_out(E),transition_out(L),transition_out(O),J=!1},d(_){_&&(detach(t),detach(me),detach(ae),detach(le),detach(ne)),destroy_each(S,_),destroy_each(I,_),destroy_each(A,_),destroy_component(Z),destroy_component(H),E&&E.d(_),L&&L.d(_),O&&O.d(_),fe=!1,run_all(ge)}}}function instance($$self,$$props,$$invalidate){let $_global,$i18n;component_subscribe($$self,_global,e=>$$invalidate(12,$_global=e)),component_subscribe($$self,i18n,e=>$$invalidate(13,$i18n=e));let{table}=$$props,{data}=$$props,{option={}}=$$props,{action={}}=$$props,{app={}}=$$props,limit=10,offset=0,sql_table_schema=[],db_data={},toast={open:!1,msg:null,type:null},modal_data={open:!1,width:12,heigth:85,header:!0,title:"Dialog Title",header_actions:[],component:null},_table={},table_metadata={name:"",comment:"",replace:!1,only_labels:!0};const data_types=[{value:"Integer",label:$i18n.t("crud.int")},{value:"String",label:$i18n.t("crud.string")},{value:"Text",label:$i18n.t("crud.text")},{value:"Date",label:$i18n.t("crud.date")},{value:"DateTime",label:$i18n.t("crud.date_time")},{value:"Time",label:$i18n.t("crud.time")},{value:"Float",label:$i18n.t("crud.float")},{value:"Boolean",label:$i18n.t("crud.boolean")}];let _table_schema={name:{type:"string",width:"w-auto",label:$i18n.t("crud.name"),editable:!0},type:{type:"select",width:"w-40",label:$i18n.t("crud.type"),editable:!0,options:data_types},primary_key:{type:"boolean",width:"w-10",label:$i18n.t("crud.primary_key"),editable:!0},autoincrement:{type:"boolean",width:"w-10",label:$i18n.t("crud.ai"),editable:!0},nullable:{type:"boolean",width:"w-10",label:$i18n.t("crud._nullable"),editable:!0},unique:{type:"boolean",width:"w-10",label:$i18n.t("crud.unique"),editable:!0},nchar:{type:"string",width:"w-10",label:$i18n.t("crud.nchar"),editable:!0},foreign_key:{type:"string",width:"w-30",label:$i18n.t("crud.foreign_key"),editable:!0},comment:{type:"string",width:"w-auto",label:$i18n.t("crud.label"),editable:!0}},id_field={name:"table_id",type:"Integer",primary_key:!0,autoincrement:!0,nullable:!1,comment:"Table ID",id_field:!0},tail_fields=[{name:"user_id",type:"Integer",nullable:!1,foreign_key:"user.user_id",comment:"User ID",tail_field:!0},{name:"app_id",type:"Integer",nullable:!1,foreign_key:"app.app_id",comment:"App ID",tail_field:!0},{name:"created_at",type:"DateTime",nullable:!1,comment:"Created At",tail_field:!0},{name:"updated_at",type:"DateTime",nullable:!1,comment:"Updated At",tail_field:!0},{name:"excluded",type:"Boolean",nullable:!1,default:!1,comment:"Excluded",tail_field:!0}],loading=!1;const save_table=async e=>{var i,o,p,c,m,r,v,u;$$invalidate(11,loading=!0),$$invalidate(8,table_metadata.table=table_metadata.name,table_metadata),$$invalidate(8,table_metadata.table_org=table,table_metadata),table_metadata.comment&&!table_metadata.table_org_desc&&$$invalidate(8,table_metadata.table_org_desc=table_metadata.comment,table_metadata),$$invalidate(8,table_metadata.table_transl_desc=table_metadata.comment,table_metadata),$$invalidate(8,table_metadata.lang=$_global==null?void 0:$_global.lang,table_metadata),$$invalidate(8,table_metadata.db=(i=data==null?void 0:data.app)==null?void 0:i.db,table_metadata),$$invalidate(8,table_metadata._table="translate_table",table_metadata);const t=[id_field,...sql_table_schema,...tail_fields];t.forEach(b=>{var $;b.field_org=b.field,b.field=b.name,b.table=table_metadata.table,b.comment&&!b.field_org_desc&&(b.field_org_desc=b.comment),b.field_transl_desc=b.comment,b.lang=$_global==null?void 0:$_global.lang,b.db=($=data==null?void 0:data.app)==null?void 0:$.db,b._table="translate_table_field"});const l={...data==null?void 0:data.app,...(o=db_data==null?void 0:db_data[table])==null?void 0:o._table};l.table=table_metadata.table,l.table_desc=table_metadata.comment;const n={lang:$_global==null?void 0:$_global.lang,conf:$_global==null?void 0:$_global.conf,token:$_global==null?void 0:$_global.token,app:data==null?void 0:data.app,data:e.data||{admin_app:$_global==null?void 0:$_global.selected_app,_table:l,table_metadata,fields:t}},s=((data==null?void 0:data.tables)||[]).map(b=>b.table);if(n!=null&&n.data)if((c=(p=n==null?void 0:n.data)==null?void 0:p.table_metadata)!=null&&c.name){if(s.includes([(r=(m=n==null?void 0:n.data)==null?void 0:m.table_metadata)==null?void 0:r.name])&&!table)return $$invalidate(11,loading=!1),$$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="error",toast),$$invalidate(5,toast.msg=$i18n.t("crud.table_name_exists",{name:(u=(v=n==null?void 0:n.data)==null?void 0:v.table_metadata)==null?void 0:u.name}),toast),null}else return $$invalidate(11,loading=!1),$$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="error",toast),$$invalidate(5,toast.msg=$i18n.t("crud.field_required",{field:$i18n.t("crud.name")}),toast),null;else return $$invalidate(11,loading=!1),$$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="error",toast),$$invalidate(5,toast.msg=$i18n.t("crud.no_data"),toast),null;const a=await save_table_schema(n);a.success===!0?($$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="success",toast),$$invalidate(5,toast.msg=a.msg,toast)):($$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="error",toast),$$invalidate(5,toast.msg=a.msg,toast)),$$invalidate(11,loading=!1)},_get_tables=async e=>{$$invalidate(11,loading=!0);try{const t={lang:$_global==null?void 0:$_global.lang,conf:$_global==null?void 0:$_global.conf,token:$_global==null?void 0:$_global.token,app:e.app,table:e.table},l=await get_tables(t);if($$invalidate(11,loading=!1),l.success===!0&&l.data)return l.data;$$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="error",toast),$$invalidate(5,toast.msg=l.msg,toast)}catch(t){console.log(t.message),$$invalidate(5,toast.open=!0,toast),$$invalidate(5,toast.type="error",toast),$$invalidate(5,toast.msg=t.message,toast)}$$invalidate(11,loading=!1)},handle_pagination=e=>{e.detail.type==="next"?$$invalidate(3,offset+=1):e.detail.type==="back"?$$invalidate(3,offset-=1):e.detail.type==="first"?$$invalidate(3,offset=0):e.detail.type==="last"?$$invalidate(3,offset=Math.ceil(limit/((e==null?void 0:e.length)||limit))):e.detail.type==="rows_per_page"&&($$invalidate(2,limit=e.detail.rows_per_page),$$invalidate(3,offset=0))},get_eval=(payload,d,field)=>{try{return eval(payload)}catch(e){return console.log(payload,d,field,e.message),!1}},dismiss_modal=e=>{$$invalidate(6,modal_data.open=!1,modal_data)},changed_field=(e,t)=>{var l;if(t.table_id&&!t._edited){t._edited=!0,t!=null&&t._edited_params||(t._edited_params=[]);const n=(l=e==null?void 0:e.target)==null?void 0:l.name;t._edited_params.includes(n)||t._edited_params.push(n)}},table_dialog_confirm=e=>{save_table({table_metadata,fields:[id_field,...sql_table_schema,...tail_fields]}),dismiss_modal()},change_table_dialog=e=>{let t=$i18n.t("crud.change_table_alert",{name:table_metadata==null?void 0:table_metadata.name});table||(t=$i18n.t("crud.create_table_alert",{name:table_metadata==null?void 0:table_metadata.name})),$$invalidate(6,modal_data.component=null,modal_data),$$invalidate(6,modal_data.msg=null,modal_data),$$invalidate(6,modal_data.html_msg=`<span class="m-2 text-lg">${t}</span>`,modal_data),$$invalidate(6,modal_data.open=!0,modal_data),$$invalidate(6,modal_data.header=!1,modal_data),$$invalidate(6,modal_data.data=e,modal_data),$$invalidate(6,modal_data.actions=[{type:"btn",icon:"ban",name:"NO",class:"btn-sm text-error",label:$i18n.t("crud.no"),action:dismiss_modal},{type:"btn",icon:"check",name:"YES",class:"btn-sm text-success",label:$i18n.t("crud.yes"),action:table_dialog_confirm}],modal_data),$$invalidate(6,modal_data.width=5,modal_data),$$invalidate(6,modal_data.heigth=null,modal_data)};onMount(async()=>{var e,t,l,n,s,a,i,o,p,c,m,r,v,u,b,$,w,j,B,C;$i18n.changeLanguage($_global==null?void 0:$_global.lang);try{hooks.locale($_global==null?void 0:$_global.lang)}catch{hooks.locale("en-us")}if(console.log("Manage Tables Mount:",{table,data,option}),table){$$invalidate(8,table_metadata.name=table,table_metadata),$$invalidate(8,table_metadata.comment=table,table_metadata),db_data=await _get_tables({table,app:data==null?void 0:data.app}),$$invalidate(8,table_metadata.table_id=(e=db_data==null?void 0:db_data[table])==null?void 0:e.table_id,table_metadata),$$invalidate(8,table_metadata={...table_metadata,...data==null?void 0:data.app,...(t=db_data==null?void 0:db_data[table])==null?void 0:t.translate_table}),$$invalidate(11,loading=!1),$$invalidate(8,table_metadata.comment=(l=db_data==null?void 0:db_data[table])==null?void 0:l.comment,table_metadata),$$invalidate(8,table_metadata._table="translate_table",table_metadata),$$invalidate(9,id_field={name:(n=db_data==null?void 0:db_data[table])==null?void 0:n.pk,type:"Integer",primary_key:!0,autoincrement:!0,nullable:!1,comment:(o=(i=(s=db_data==null?void 0:db_data[table])==null?void 0:s.fields)==null?void 0:i[(a=db_data==null?void 0:db_data[table])==null?void 0:a.pk])==null?void 0:o.comment,id_field:!0,...(m=(p=db_data==null?void 0:db_data[table])==null?void 0:p.translate_table_field)==null?void 0:m[(c=db_data==null?void 0:db_data[table])==null?void 0:c.pk],_table:"translate_table_field"});for(const U in(r=db_data==null?void 0:db_data[table])==null?void 0:r.fields)if(Object.hasOwnProperty.call((v=db_data==null?void 0:db_data[table])==null?void 0:v.fields,U)&&U!==((u=db_data==null?void 0:db_data[table])==null?void 0:u.pk)){const g=(b=db_data==null?void 0:db_data[table])==null?void 0:b.fields[U];let q=g.type,z=q.split("("),M=null;z.length>1&&(q=z[0],M=z[1].replace(")","")),["integer","int"].includes(q.toLowerCase())?q="Integer":["text","longtext"].includes(q.toLowerCase())?q="Text":["string","varchar","nchar","char"].includes(q.toLowerCase())?q="String":["boolean","bool"].includes(q.toLowerCase())?q="Boolean":["date"].includes(q.toLowerCase())?q="Date":["datetime","timestamp"].includes(q.toLowerCase())?q="DateTime":["time"].includes(q.toLowerCase())&&(q="Time");let k=null;g.fk&&g.ref&&(k=`${($=g==null?void 0:g.ref)==null?void 0:$.referred_table}.${(w=g==null?void 0:g.ref)==null?void 0:w.referred_column}`);const V={name:g.name,type:q,nchar:M,comment:g.comment,default:g.default,nullable:g.nullable,unique:g.unique,foreign_key:k,table,table_id:(j=db_data==null?void 0:db_data[table])==null?void 0:j.table_id,...(C=(B=db_data==null?void 0:db_data[table])==null?void 0:B.translate_table_field)==null?void 0:C[g.name]};V._table="translate_table_field",$$invalidate(4,sql_table_schema=[...sql_table_schema,lodashExports.cloneDeep(V)])}$$invalidate(10,tail_fields=[]),lodashExports.cloneDeep(sql_table_schema),console.log({sql_table_schema})}});function input0_input_handler(){table_metadata.name=this.value,$$invalidate(8,table_metadata)}const change_handler=e=>{var t;if(((t=table_metadata.name)==null?void 0:t.length)>1){let l=/_|-+?|\s+?|\t+?|\n+?/;const n=e.target.value.replace(l,"_");l=/_+?|-+?/,$$invalidate(9,id_field={...id_field,name:`${n}_id`,comment:`${n[0].toUpperCase()}${n.replace(l," ").substring(1)} ID`}),table_metadata.comment||$$invalidate(8,table_metadata.comment=`${n[0].toUpperCase()}${n.replace(l," ").substring(1)}`,table_metadata),$$invalidate(8,table_metadata.name=n,table_metadata)}};function input1_input_handler(){table_metadata.comment=this.value,$$invalidate(8,table_metadata)}function input2_change_handler(){table_metadata.replace=this.checked,$$invalidate(8,table_metadata)}function input_change_handler(e,t,l){t[l][e]=this.checked,$$invalidate(9,id_field),$$invalidate(4,sql_table_schema),$$invalidate(10,tail_fields),$$invalidate(3,offset),$$invalidate(2,limit),$$invalidate(14,_table_schema)}const change_handler_1=(e,t)=>changed_field(t,e);function select_change_handler(e,t,l){t[l][e]=select_value(this),$$invalidate(9,id_field),$$invalidate(4,sql_table_schema),$$invalidate(10,tail_fields),$$invalidate(3,offset),$$invalidate(2,limit),$$invalidate(14,_table_schema)}const change_handler_2=(e,t)=>changed_field(t,e);function input_input_handler(e,t,l){t[l][e]=this.value,$$invalidate(9,id_field),$$invalidate(4,sql_table_schema),$$invalidate(10,tail_fields),$$invalidate(3,offset),$$invalidate(2,limit),$$invalidate(14,_table_schema)}const change_handler_3=(e,t)=>changed_field(t,e),click_handler=(e,t,l)=>{var n,s;try{if(!e.id_field)if(e.tail_field){const a=tail_fields.map((i,o)=>(i.index=o,i)).filter(i=>i.name===e.name);tail_fields.splice((n=a==null?void 0:a[0])==null?void 0:n.index,1),$$invalidate(10,tail_fields=[...tail_fields])}else if(e.table_id)$$invalidate(9,t[l]._remove=!0,id_field,$$invalidate(4,sql_table_schema),$$invalidate(10,tail_fields),$$invalidate(3,offset),$$invalidate(2,limit)),$$invalidate(4,sql_table_schema=[...sql_table_schema]);else{const a=sql_table_schema.map((i,o)=>(i.index=o,i)).filter(i=>i.name===e.name);sql_table_schema.splice((s=a==null?void 0:a[0])==null?void 0:s.index,1),$$invalidate(4,sql_table_schema=[...sql_table_schema])}}catch{}},click_handler_1=e=>{var t,l,n;try{if(!e.id_field){if(e.tail_field){const s=tail_fields.map((a,i)=>(a.index=i,a)).filter(a=>a.name===e.name);$$invalidate(10,tail_fields=[...tail_fields])}else if(!e.id_field)if(e.tail_field){const s=tail_fields.map((a,i)=>(a.index=i,a)).filter(a=>a.name===e.name);$$invalidate(10,tail_fields=[...tail_fields])}else{const s=sql_table_schema.map((a,i)=>(a.index=i,a)).filter(a=>a.name===e.name);if(((t=s==null?void 0:s[0])==null?void 0:t.index)<sql_table_schema.length-1){const a=lodashExports.cloneDeep(e);sql_table_schema.splice((l=s==null?void 0:s[0])==null?void 0:l.index,1),sql_table_schema.splice(((n=s==null?void 0:s[0])==null?void 0:n.index)+1,0,a),$$invalidate(4,sql_table_schema=[...sql_table_schema])}}}}catch{}},click_handler_2=e=>{var t,l,n;try{if(!e.id_field)if(e.tail_field){const s=tail_fields.map((a,i)=>(a.index=i,a)).filter(a=>a.name===e.name);$$invalidate(10,tail_fields=[...tail_fields])}else{const s=sql_table_schema.map((a,i)=>(a.index=i,a)).filter(a=>a.name===e.name);if(((t=s==null?void 0:s[0])==null?void 0:t.index)>0){const a=lodashExports.cloneDeep(e);sql_table_schema.splice((l=s==null?void 0:s[0])==null?void 0:l.index,1),sql_table_schema.splice(((n=s==null?void 0:s[0])==null?void 0:n.index)-1,0,a),$$invalidate(4,sql_table_schema=[...sql_table_schema])}}}catch{}};function input_change_handler_1(e){_table[e]=this.checked,$$invalidate(7,_table),$$invalidate(14,_table_schema)}function input_input_handler_1(e){_table[e]=this.value,$$invalidate(7,_table),$$invalidate(14,_table_schema)}function select_change_handler_1(e){_table[e]=select_value(this),$$invalidate(7,_table),$$invalidate(14,_table_schema)}const change_handler_4=e=>{var t,l;(t=_table_schema==null?void 0:_table_schema[e])!=null&&t._on_change&&((l=_table_schema==null?void 0:_table_schema[e])==null||l._on_change({table:_table[e],app_id:app.app_id}))},click_handler_3=()=>{var e;try{if(!(!(_table!=null&&_table.name)||!(_table!=null&&_table.type)||!(_table!=null&&_table.comment))){if(table&&$$invalidate(7,_table._added=!0,_table),console.log(tail_fields,table_metadata),tail_fields.length===0&&(table_metadata!=null&&table_metadata.table_id)){const t=[];let l=!1;const n=((e=$_global==null?void 0:$_global.conf)==null?void 0:e.tail_fields)||["user_id","app_id","created_at","updated_at","excluded"];sql_table_schema.forEach(s=>{n.includes(s.name)&&l===!1&&(l=!0,t.push(_table)),t.push(s)}),$$invalidate(4,sql_table_schema=[...lodashExports.cloneDeep(t)])}else $$invalidate(4,sql_table_schema=[...sql_table_schema,Object.assign({},_table)]);$$invalidate(7,_table={})}}catch(t){console.log("err adding table:",t.message)}},pageChange_handler=e=>handle_pagination({detail:e.detail,length:[id_field,...sql_table_schema,...tail_fields].length}),dismiss_handler=e=>{$$invalidate(5,toast.open=!1,toast)},dismiss_handler_1=e=>dismiss_modal(e.detail);return $$self.$$set=e=>{"table"in e&&$$invalidate(0,table=e.table),"data"in e&&$$invalidate(19,data=e.data),"option"in e&&$$invalidate(20,option=e.option),"action"in e&&$$invalidate(21,action=e.action),"app"in e&&$$invalidate(1,app=e.app)},$$self.$$.update=()=>{$$self.$$.dirty[0]&1&&console.log({table}),$$self.$$.dirty[0]&2097152&&((action==null?void 0:action.name)=="CANCEL"&&(action==null||action.action()),(action==null?void 0:action.name)=="SAVE"&&change_table_dialog({}))},[table,app,limit,offset,sql_table_schema,toast,modal_data,_table,table_metadata,id_field,tail_fields,loading,$_global,$i18n,_table_schema,handle_pagination,get_eval,dismiss_modal,changed_field,data,option,action,input0_input_handler,change_handler,input1_input_handler,input2_change_handler,input_change_handler,change_handler_1,select_change_handler,change_handler_2,input_input_handler,change_handler_3,click_handler,click_handler_1,click_handler_2,input_change_handler_1,input_input_handler_1,select_change_handler_1,change_handler_4,click_handler_3,pageChange_handler,dismiss_handler,dismiss_handler_1]}class ManageDBTable extends SvelteComponent{constructor(t){super(),init(this,t,instance,create_fragment,safe_not_equal,{table:0,data:19,option:20,action:21,app:1},null,[-1,-1,-1])}}export{ManageDBTable as default};
