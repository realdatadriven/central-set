import{S as wt,i as kt,s as pt,z as Le,I as Oe,e as E,t as pe,a as U,c as oe,b as w,A as Ne,B as Ae,d as ae,f as b,m as ce,l as W,n as Fe,g as O,h as ve,j,k as De,o as me,p as fe,D as Je,q as nt,_ as vt,r as Dt,u as qt,F as st,P as Te,C as Ve,v as Ie,w as bt,x as gt,T as St,H as Et,M as Mt,J as Ot,K as Ft,L as Nt,y,W as At,a4 as jt,$ as zt,N as Bt,a5 as Tt,a0 as Lt,a1 as rt,U as qe,a8 as lt}from"./index-8239faad.js";import"./pt-4424e41e.js";import Vt from"./DataViz-a7855331.js";function it(s,n,t){const r=s.slice();return r[51]=n[t],r[52]=n,r[53]=t,r}function ot(s,n,t){const r=s.slice();return r[54]=n[t],r}function ct(s){let n,t,r,l,f;return{c(){var m,k;n=E("div"),t=E("input"),w(t,"type","text"),w(t,"class","input input-bordered input-sm flex-grow"),w(n,"class","w-3/12 pl-4"),w(n,"title",r=Ne((k=(m=s[1])==null?void 0:m.dashboard_conf)==null?void 0:k.label,30)),Ae(n,"display",s[3]?null:"none")},m(m,k){ae(m,n,k),b(n,t),Ve(t,s[1].dashboard_conf.label),l||(f=[W(t,"input",s[24]),W(n,"dblclick",s[25])],l=!0)},p(m,k){var o,_;k[0]&130&&t.value!==m[1].dashboard_conf.label&&Ve(t,m[1].dashboard_conf.label),k[0]&130&&r!==(r=Ne((_=(o=m[1])==null?void 0:o.dashboard_conf)==null?void 0:_.label,30))&&w(n,"title",r),k[0]&8&&Ae(n,"display",m[3]?null:"none")},d(m){m&&me(n),l=!1,Je(f)}}}function ft(s){var m,k;let n,t,r=Ie(((k=(m=s[1])==null?void 0:m.dashboard_conf)==null?void 0:k.items)||[]),l=[];for(let o=0;o<r.length;o+=1)l[o]=at(it(s,r,o));const f=o=>j(l[o],1,1,()=>{l[o]=null});return{c(){for(let o=0;o<l.length;o+=1)l[o].c();n=bt()},m(o,_){for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(o,_);ae(o,n,_),t=!0},p(o,_){var a,h;if(_[0]&30854){r=Ie(((h=(a=o[1])==null?void 0:a.dashboard_conf)==null?void 0:h.items)||[]);let i;for(i=0;i<r.length;i+=1){const p=it(o,r,i);l[i]?(l[i].p(p,_),O(l[i],1)):(l[i]=at(p),l[i].c(),O(l[i],1),l[i].m(n.parentNode,n))}for(ve(),i=r.length;i<l.length;i+=1)f(i);De()}},i(o){if(!t){for(let _=0;_<r.length;_+=1)O(l[_]);t=!0}},o(o){l=l.filter(Boolean);for(let _=0;_<l.length;_+=1)j(l[_]);t=!1},d(o){o&&me(n),gt(l,o)}}}function ut(s){let n,t,r,l;const f=[Rt,Pt,Jt,It],m=[];function k(o,_){var a,h,i,p,q,N,V,g;return(a=o[51])!=null&&a.loading?0:((p=(i=o[7])==null?void 0:i[(h=o[51])==null?void 0:h._id])==null?void 0:p.sucess)===!1?1:((q=o[51])==null?void 0:q.component)==="Filter"?2:(g=(V=o[7])==null?void 0:V[(N=o[51])==null?void 0:N._id])!=null&&g.data?3:-1}return~(n=k(s))&&(t=m[n]=f[n](s)),{c(){t&&t.c(),r=bt()},m(o,_){~n&&m[n].m(o,_),ae(o,r,_),l=!0},p(o,_){let a=n;n=k(o),n===a?~n&&m[n].p(o,_):(t&&(ve(),j(m[a],1,1,()=>{m[a]=null}),De()),~n?(t=m[n],t?t.p(o,_):(t=m[n]=f[n](o),t.c()),O(t,1),t.m(r.parentNode,r)):t=null)},i(o){l||(O(t),l=!0)},o(o){j(t),l=!1},d(o){o&&me(r),~n&&m[n].d(o)}}}function It(s){var r,l,f,m,k;let n,t;return n=new Vt({props:{_id:(r=s[51])==null?void 0:r._id,component:(l=s[51])==null?void 0:l.component,options:y.cloneDeep(s[51]),data:((k=(m=s[7])==null?void 0:m[(f=s[51])==null?void 0:f._id])==null?void 0:k.data)||[]}}),{c(){oe(n.$$.fragment)},m(o,_){ce(n,o,_),t=!0},p(o,_){var h,i,p,q,N;const a={};_[0]&2&&(a._id=(h=o[51])==null?void 0:h._id),_[0]&2&&(a.component=(i=o[51])==null?void 0:i.component),_[0]&2&&(a.options=y.cloneDeep(o[51])),_[0]&130&&(a.data=((N=(q=o[7])==null?void 0:q[(p=o[51])==null?void 0:p._id])==null?void 0:N.data)||[]),n.$set(a)},i(o){t||(O(n.$$.fragment,o),t=!0)},o(o){j(n.$$.fragment,o),t=!1},d(o){fe(n,o)}}}function Jt(s){var k,o,_;let n,t,r,l=Ie(((_=(o=s[7])==null?void 0:o[(k=s[51])==null?void 0:k._id])==null?void 0:_.data)||[]),f=[];for(let a=0;a<l.length;a+=1)f[a]=_t(ot(s,l,a));function m(){s[33].call(n,s[51])}return{c(){var a,h;n=E("select");for(let i=0;i<f.length;i+=1)f[i].c();w(n,"class","select select-sm -select-bordered w-full m-0"),s[2][(h=(a=s[51])==null?void 0:a.options)==null?void 0:h.name]===void 0&&Lt(m)},m(a,h){var i,p;ae(a,n,h);for(let q=0;q<f.length;q+=1)f[q]&&f[q].m(n,null);rt(n,s[2][(p=(i=s[51])==null?void 0:i.options)==null?void 0:p.name],!0),t||(r=[W(n,"change",m),W(n,"change",Ht)],t=!0)},p(a,h){var i,p,q,N,V;if(s=a,h[0]&130){l=Ie(((q=(p=s[7])==null?void 0:p[(i=s[51])==null?void 0:i._id])==null?void 0:q.data)||[]);let g;for(g=0;g<l.length;g+=1){const u=ot(s,l,g);f[g]?f[g].p(u,h):(f[g]=_t(u),f[g].c(),f[g].m(n,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=l.length}h[0]&134&&rt(n,s[2][(V=(N=s[51])==null?void 0:N.options)==null?void 0:V.name])},i:qe,o:qe,d(a){a&&me(n),gt(f,a),t=!1,Je(r)}}}function Pt(s){var o,_,a;let n,t,r,l,f,m=((a=(_=s[7])==null?void 0:_[(o=s[51])==null?void 0:o._id])==null?void 0:a.msg)+"",k;return{c(){n=E("div"),t=lt("svg"),r=lt("path"),l=U(),f=E("span"),k=pe(m),w(r,"stroke-linecap","round"),w(r,"stroke-linejoin","round"),w(r,"stroke-width","2"),w(r,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),w(t,"xmlns","http://www.w3.org/2000/svg"),w(t,"class","stroke-current shrink-0 h-6 w-6"),w(t,"fill","none"),w(t,"viewBox","0 0 24 24"),w(n,"class","alert alert-error")},m(h,i){ae(h,n,i),b(n,t),b(t,r),b(n,l),b(n,f),b(f,k)},p(h,i){var p,q,N;i[0]&130&&m!==(m=((N=(q=h[7])==null?void 0:q[(p=h[51])==null?void 0:p._id])==null?void 0:N.msg)+"")&&Fe(k,m)},i:qe,o:qe,d(h){h&&me(n)}}}function Rt(s){let n;return{c(){n=E("span"),w(n,"class","loading loading-spinner loading-xs")},m(t,r){ae(t,n,r)},p:qe,i:qe,o:qe,d(t){t&&me(n)}}}function _t(s){var m,k,o;let n,t=((o=s[54])==null?void 0:o[(k=(m=s[51])==null?void 0:m.options)==null?void 0:k.value_field])+"",r,l,f;return{c(){var _,a,h;n=E("option"),r=pe(t),l=U(),n.__value=f=(h=s[54])==null?void 0:h[(a=(_=s[51])==null?void 0:_.options)==null?void 0:a.label_field],Ve(n,n.__value)},m(_,a){ae(_,n,a),b(n,r),b(n,l)},p(_,a){var h,i,p,q,N,V;a[0]&130&&t!==(t=((p=_[54])==null?void 0:p[(i=(h=_[51])==null?void 0:h.options)==null?void 0:i.value_field])+"")&&Fe(r,t),a[0]&130&&f!==(f=(V=_[54])==null?void 0:V[(N=(q=_[51])==null?void 0:q.options)==null?void 0:N.label_field])&&(n.__value=f,Ve(n,n.__value))},d(_){_&&me(n)}}}function at(s){var z,B,T;let n,t,r,l,f=(["MiniStat"].includes((z=s[51])==null?void 0:z.component)?"":Le((B=s[51])==null?void 0:B.label))+"",m,k,o,_,a,h,i,p,q,N,V,g,u,Y,J,Q,ee,X,Z=!["Blank"].includes((T=s[51])==null?void 0:T.component),ue,x,G,P,_e,$;i=new Oe({props:{type:"outline",icon:"pencil",path:"icons"}});function Se(){return s[30](s[53],s[51])}V=new Oe({props:{type:"outline",icon:"trash",path:"icons"}});function he(){return s[31](s[53],s[51])}J=new Oe({props:{type:"outline",icon:"document-duplicate",path:"icons"}});function te(){return s[32](s[53],s[51])}let D=Z&&ut(s);function be(...F){return s[34](s[53],s[51],...F)}function Ee(...F){return s[35](s[53],s[51],...F)}function C(...F){return s[36](s[53],s[51],...F)}function L(...F){return s[37](s[53],s[51],...F)}return{c(){var F,R,ne,se,re,v,A,le;n=E("div"),t=E("div"),r=E("div"),l=E("span"),m=pe(f),o=U(),_=E("div"),a=E("button"),h=E("span"),oe(i.$$.fragment),p=U(),q=E("button"),N=E("span"),oe(V.$$.fragment),g=U(),u=E("button"),Y=E("span"),oe(J.$$.fragment),ee=U(),X=E("div"),D&&D.c(),x=U(),w(l,"class","flex-grow pl-2"),w(l,"title",k=Ne((F=s[51])==null?void 0:F.label)),w(h,"class","w-4 h-4"),w(a,"class","btn btn-square btn-ghost btn-xs"),w(N,"class","w-4 h-4"),w(q,"class","btn btn-square btn-ghost btn-xs"),w(Y,"class","w-4 h-4"),w(u,"class","btn btn-square btn-ghost btn-xs"),w(_,"class","w-auto flex flex-row justify-end flex-wrap overflow-x-hidden overflow-y-hidden"),w(r,"class",Q="card-title flex flex-row "+(["Filter"].includes((R=s[51])==null?void 0:R.component)?" !mb-0 ":"")+" "+(["MiniStat"].includes((ne=s[51])==null?void 0:ne.component)?" z-[1] !-mb-6 ":" text-xs border-b-2 border-b-slate-50 ")),w(X,"class",ue="card-body items-center text-center "+(["Filter","MiniStat","Blank_"].includes((se=s[51])==null?void 0:se.component)?"!p-0":"")),w(t,"class","card card-bordered shadow-xs rounded-md w-full card-compact"),Ae(t,"minHeight",((re=s[51])==null?void 0:re.height)||"250px"),w(n,"class",G=(((v=s[51])==null?void 0:v.width)===12?`w-[${((((A=s[51])==null?void 0:A.width)||12)/12*100).toFixed(0)}%]`:`w-${((le=s[51])==null?void 0:le.width)||11}/12`)+" flex-none p-0.5 ---m-auto --border --border-red-500"),w(n,"draggable",!0)},m(F,R){ae(F,n,R),b(n,t),b(t,r),b(r,l),b(l,m),b(r,o),b(r,_),b(_,a),b(a,h),ce(i,h,null),b(_,p),b(_,q),b(q,N),ce(V,N,null),b(_,g),b(_,u),b(u,Y),ce(J,Y,null),b(t,ee),b(t,X),D&&D.m(X,null),b(n,x),P=!0,_e||($=[W(a,"click",Se),W(q,"click",he),W(u,"click",te),W(n,"dragstart",be),W(n,"dragover",Ee),W(n,"drop",C),W(n,"dragend",L)],_e=!0)},p(F,R){var ne,se,re,v,A,le,ge,we,ke,e,c;s=F,(!P||R[0]&2)&&f!==(f=(["MiniStat"].includes((ne=s[51])==null?void 0:ne.component)?"":Le((se=s[51])==null?void 0:se.label))+"")&&Fe(m,f),(!P||R[0]&130&&k!==(k=Ne((re=s[51])==null?void 0:re.label)))&&w(l,"title",k),(!P||R[0]&130&&Q!==(Q="card-title flex flex-row "+(["Filter"].includes((v=s[51])==null?void 0:v.component)?" !mb-0 ":"")+" "+(["MiniStat"].includes((A=s[51])==null?void 0:A.component)?" z-[1] !-mb-6 ":" text-xs border-b-2 border-b-slate-50 ")))&&w(r,"class",Q),R[0]&2&&(Z=!["Blank"].includes((le=s[51])==null?void 0:le.component)),Z?D?(D.p(s,R),R[0]&2&&O(D,1)):(D=ut(s),D.c(),O(D,1),D.m(X,null)):D&&(ve(),j(D,1,1,()=>{D=null}),De()),(!P||R[0]&130&&ue!==(ue="card-body items-center text-center "+(["Filter","MiniStat","Blank_"].includes((ge=s[51])==null?void 0:ge.component)?"!p-0":"")))&&w(X,"class",ue),R[0]&2&&Ae(t,"minHeight",((we=s[51])==null?void 0:we.height)||"250px"),(!P||R[0]&130&&G!==(G=(((ke=s[51])==null?void 0:ke.width)===12?`w-[${((((e=s[51])==null?void 0:e.width)||12)/12*100).toFixed(0)}%]`:`w-${((c=s[51])==null?void 0:c.width)||11}/12`)+" flex-none p-0.5 ---m-auto --border --border-red-500"))&&w(n,"class",G)},i(F){P||(O(i.$$.fragment,F),O(V.$$.fragment,F),O(J.$$.fragment,F),O(D),P=!0)},o(F){j(i.$$.fragment,F),j(V.$$.fragment,F),j(J.$$.fragment,F),j(D),P=!1},d(F){F&&me(n),fe(i),fe(V),fe(J),D&&D.d(),_e=!1,Je($)}}}function mt(s){let n,t;return n=new St({props:{open:s[4].open,type:s[4].type,msg:s[4].msg,timer:2e4}}),n.$on("dismiss",s[38]),{c(){oe(n.$$.fragment)},m(r,l){ce(n,r,l),t=!0},p(r,l){const f={};l[0]&16&&(f.open=r[4].open),l[0]&16&&(f.type=r[4].type),l[0]&16&&(f.msg=r[4].msg),n.$set(f)},i(r){t||(O(n.$$.fragment,r),t=!0)},o(r){j(n.$$.fragment,r),t=!1},d(r){fe(n,r)}}}function ht(s){let n,t;const r=[s[5]];let l={};for(let f=0;f<r.length;f+=1)l=Et(l,r[f]);return n=new Mt({props:l}),n.$on("dismiss",s[39]),{c(){oe(n.$$.fragment)},m(f,m){ce(n,f,m),t=!0},p(f,m){const k=m[0]&32?Ot(r,[Ft(f[5])]):{};n.$set(k)},i(f){t||(O(n.$$.fragment,f),t=!0)},o(f){j(n.$$.fragment,f),t=!1},d(f){fe(n,f)}}}function dt(s){let n,t;return n=new Nt({props:{open:s[6]}}),{c(){oe(n.$$.fragment)},m(r,l){ce(n,r,l),t=!0},p(r,l){const f={};l[0]&64&&(f.open=r[6]),n.$set(f)},i(r){t||(O(n.$$.fragment,r),t=!0)},o(r){j(n.$$.fragment,r),t=!1},d(r){fe(n,r)}}}function Ct(s){var F,R,ne,se,re;let n,t,r,l,f=Le((R=(F=s[1])==null?void 0:F.dashboard_conf)==null?void 0:R.label,30)+"",m,k,o,_,a,h=s[8].t("crud.filter")+"",i,p,q=JSON.stringify(s[2])+"",N,V,g,u,Y,J,Q,ee,X,Z,ue,x,G,P,_e,$,Se,he,te,D,be,Ee,C=((ne=s[1])==null?void 0:ne.dashboard_conf)&&ct(s);J=new Oe({props:{type:"outline",icon:"save",path:"icons"}}),Z=new Oe({props:{type:"outline",icon:"refresh",path:"icons"}}),P=new Oe({props:{type:"outline",icon:"trash",path:"icons"}});let L=((re=(se=s[1])==null?void 0:se.dashboard_conf)==null?void 0:re.items)&&ft(s),z=s[4].open&&mt(s),B=s[5].open&&ht(s),T=s[6]&&dt(s);return{c(){var v,A;n=E("div"),t=E("div"),r=E("div"),l=E("span"),m=pe(f),o=U(),C&&C.c(),_=U(),a=E("div"),i=pe(h),p=pe("s: "),N=pe(q),V=U(),g=E("div"),u=E("button"),Y=E("span"),oe(J.$$.fragment),Q=U(),ee=E("button"),X=E("span"),oe(Z.$$.fragment),ue=U(),x=E("button"),G=E("span"),oe(P.$$.fragment),_e=U(),$=E("div"),L&&L.c(),Se=U(),z&&z.c(),he=U(),B&&B.c(),te=U(),T&&T.c(),w(l,"class","text-md font-bold text-primary"),w(r,"class","w-3/12 pl-4"),w(r,"title",k=Ne((A=(v=s[1])==null?void 0:v.dashboard_conf)==null?void 0:A.label,30)),Ae(r,"display",s[3]?"none":null),w(a,"class","flex-grow flex flex-row overflow-x-auto overflow-y-hidden"),w(Y,"class","w-5 h-5"),w(u,"class","btn btn-square btn-ghost btn-sm"),w(X,"class","w-5 h-5"),w(ee,"class","btn btn-square btn-ghost btn-sm"),w(G,"class","w-5 h-5"),w(x,"class","btn btn-square btn-ghost btn-sm"),w(g,"class","w-auto flex flex-row justify-end flex-wrap overflow-x-hidden overflow-y-hidden"),w(t,"class","--navbar --navbar-xs w-full border-b-2 rounded-md border-slate-200 p-0 flex flex-row m-0.5 h-8"),w($,"class","w-full flex flex-row justify-start flex-wrap overflow-x-hidden overflow-y-auto"),w(n,"class","w-full p-2")},m(v,A){ae(v,n,A),b(n,t),b(t,r),b(r,l),b(l,m),b(t,o),C&&C.m(t,null),b(t,_),b(t,a),b(a,i),b(a,p),b(a,N),b(t,V),b(t,g),b(g,u),b(u,Y),ce(J,Y,null),b(g,Q),b(g,ee),b(ee,X),ce(Z,X,null),b(g,ue),b(g,x),b(x,G),ce(P,G,null),b(n,_e),b(n,$),L&&L.m($,null),b(n,Se),z&&z.m(n,null),b(n,he),B&&B.m(n,null),b(n,te),T&&T.m(n,null),D=!0,be||(Ee=[W(r,"dblclick",s[23]),W(u,"click",s[26]),W(ee,"click",s[27]),W(x,"click",s[28]),W(t,"drop",s[29])],be=!0)},p(v,A){var le,ge,we,ke,e,c,S;(!D||A[0]&2)&&f!==(f=Le((ge=(le=v[1])==null?void 0:le.dashboard_conf)==null?void 0:ge.label,30)+"")&&Fe(m,f),(!D||A[0]&130&&k!==(k=Ne((ke=(we=v[1])==null?void 0:we.dashboard_conf)==null?void 0:ke.label,30)))&&w(r,"title",k),A[0]&8&&Ae(r,"display",v[3]?"none":null),(e=v[1])!=null&&e.dashboard_conf?C?C.p(v,A):(C=ct(v),C.c(),C.m(t,_)):C&&(C.d(1),C=null),(!D||A[0]&256)&&h!==(h=v[8].t("crud.filter")+"")&&Fe(i,h),(!D||A[0]&4)&&q!==(q=JSON.stringify(v[2])+"")&&Fe(N,q),(S=(c=v[1])==null?void 0:c.dashboard_conf)!=null&&S.items?L?(L.p(v,A),A[0]&2&&O(L,1)):(L=ft(v),L.c(),O(L,1),L.m($,null)):L&&(ve(),j(L,1,1,()=>{L=null}),De()),v[4].open?z?(z.p(v,A),A[0]&16&&O(z,1)):(z=mt(v),z.c(),O(z,1),z.m(n,he)):z&&(ve(),j(z,1,1,()=>{z=null}),De()),v[5].open?B?(B.p(v,A),A[0]&32&&O(B,1)):(B=ht(v),B.c(),O(B,1),B.m(n,te)):B&&(ve(),j(B,1,1,()=>{B=null}),De()),v[6]?T?(T.p(v,A),A[0]&64&&O(T,1)):(T=dt(v),T.c(),O(T,1),T.m(n,null)):T&&(ve(),j(T,1,1,()=>{T=null}),De())},i(v){D||(O(J.$$.fragment,v),O(Z.$$.fragment,v),O(P.$$.fragment,v),O(L),O(z),O(B),O(T),D=!0)},o(v){j(J.$$.fragment,v),j(Z.$$.fragment,v),j(P.$$.fragment,v),j(L),j(z),j(B),j(T),D=!1},d(v){v&&me(n),C&&C.d(),fe(J),fe(Z),fe(P),L&&L.d(),z&&z.d(),B&&B.d(),T&&T.d(),be=!1,Je(Ee)}}}const Ht=s=>{};function Kt(s,n,t){let r,l;nt(s,vt,e=>t(42,r=e)),nt(s,Dt,e=>t(8,l=e));let{_id:f}=n,{table:m}=n,{data:k={}}=n,{aux_data:o={}}=n,{main_table:_=null}=n,{actions:a={}}=n,{action:h={}}=n,i={},p={},q=!1,N={label:"Not named dashboard",refresh_each_ms:1e4,filters:{},items:[{label:"item 1",width:4,height:"240px",component:"EChartsEngine",options:{type:""},raw_sql:!1,query:null,sql:null}]};const V=`key_${Math.floor(Math.random()*Date.now())}`;let g={open:!1,msg:null,type:null},u={open:!1,width:12,heigth:85,header:!0,title:"Dialog Title",header_actions:[],component:null},Y=!1;const J=async e=>{var I;const c=y.cloneDeep(e.data||i);(I=c==null?void 0:c.dashboard_conf)!=null&&I.items&&(c.dashboard_conf.filters={},c.dashboard_conf.items=c.dashboard_conf.items.map(H=>({...H,_id:null})),c.dashboard_conf=JSON.stringify(c.dashboard_conf)),console.log({_data:c}),t(6,Y=!0);const S={lang:r==null?void 0:r.lang,conf:r==null?void 0:r.conf,token:r==null?void 0:r.token,app:r==null?void 0:r.selected_app,table:e.table||m,data:c},M=await At(S);if(M.success===!0){t(4,g.open=!0,g),t(4,g.type="success",g),t(4,g.msg=M.msg,g),M.inserted_primary_key&&t(1,i[r.tables[e.table].pk]=M.inserted_primary_key,i);try{h!=null&&h.action&&(h==null||h.action(i))}catch(H){console.log(H.message)}}else t(4,g.open=!0,g),t(4,g.type="error",g),t(4,g.msg=M.msg,g),M!=null&&M.errors&&M.errors.length>0&&(t(5,u.html_msg='<div class="alert alert-error shadow-lg m-1">'+M.errors.map(H=>H).join('</div><div class="alert alert-error shadow-lg m-1">')+"</div>",u),t(5,u.open=!0,u),t(5,u.header=!0,u),t(5,u.title=M.msg,u),t(5,u.actions=[{type:"btn",name:"OK",class:"text-primary--",label:l.t("crud.ok"),action:Q}],u),t(5,u.width=4,u),t(5,u.heigth=null,u));t(6,Y=!1)},Q=e=>{t(5,u.open=!1,u)},ee=async e=>{var S,M,I,H;const c={lang:r==null?void 0:r.lang,conf:r==null?void 0:r.conf,token:r==null?void 0:r.token,app:r==null?void 0:r.selected_app,table:e==null?void 0:e.table,limit:(e==null?void 0:e.limit)||-1,distinct:(e==null?void 0:e.distinct)||!1,database:(e==null?void 0:e.database)||null,fields:((M=(S=e==null?void 0:e.fields)==null?void 0:S.split(";"))==null?void 0:M.length)>1?(I=e==null?void 0:e.fields)==null?void 0:I.split(";"):((H=e==null?void 0:e.fields)==null?void 0:H.split(","))||null};return await Bt(c)},X=async e=>{var I,H,ie,de;let c={},S=null;try{c=JSON.parse((I=e==null?void 0:e.query)==null?void 0:I.manage_query_conf),S=(c==null?void 0:c.selected_tab)==="query_preview"?c==null?void 0:c.selected_tab_2_prev:c==null?void 0:c.selected_tab}catch{throw new Error(l.t("crud.no_query_setup"))}const M={class:"crud",method:"query",conf:r==null?void 0:r.conf,token:r==null?void 0:r.token,app:r==null?void 0:r.selected_app,data:{build_query:(ie=(H=c==null?void 0:c.tabs)==null?void 0:H[S])==null?void 0:ie.fields,filters:(e==null?void 0:e.filters)||p,query:e==null?void 0:e.sql,use_query_string:(e==null?void 0:e.raw_sql)||!1,database:(e==null?void 0:e.database)||((de=e==null?void 0:e.query)==null?void 0:de.database),limit:-1,offset:0}};return await Tt(M)},Z=e=>{console.log("_save_edited_item:",e),t(1,i.dashboard_conf.items[e==null?void 0:e.index]=y.cloneDeep(e==null?void 0:e.item),i),t(1,i={...i})},ue=async e=>{var S;t(6,Y=!0);const c=(await Te(()=>import("./EditDashboardItem-9031f5a2.js"),["assets/EditDashboardItem-9031f5a2.js","assets/index-8239faad.js","assets/index-72afd4a3.css","assets/pt-4424e41e.js","assets/ObjectEditor-4da1c4e4.js"])).default;if(t(6,Y=!1),e!=null&&e.show_in_popup)t(5,u.actions=null,u),t(5,u.component=c,u),t(5,u.msg=null,u),t(5,u.html_msg=null,u),t(5,u.header_actions=[{type:"icon",icon:"save",name:"SAVE",label:l.t("crud.save"),action:Z}],u),t(5,u.title=`${l.t("crud.edit")} ${l.t("crud.item")}`,u),t(5,u.data={item:y.cloneDeep(e==null?void 0:e._item),index:e==null?void 0:e.i},u),t(5,u.width=80,u),t(5,u.heigth=99,u),t(5,u.open=!0,u);else{const M=`${l.t("crud.edit")} ${l.t("crud.item")} - ${(S=e==null?void 0:e._item)==null?void 0:S.label} `;a.show_in_tabs({component:c,label:M,header_actions:[{type:"icon",icon:"save",name:"SAVE",label:l.t("crud.save"),action:Z}],show_top_close:!0,data:{label:M,table:e.table||m,item:y.cloneDeep(e==null?void 0:e._item),index:e==null?void 0:e.i,mode:"tab"}})}},x=e=>{switch(e==null?void 0:e.action){case"delete":i.dashboard_conf.items.splice(e==null?void 0:e.i,1),t(1,i={...i});break;case"duplicate":try{i.dashboard_conf.items.splice((e==null?void 0:e.i)+1,0,y.cloneDeep({...e==null?void 0:e._item,_id:null}))}catch{i.dashboard_conf.items.push(y.cloneDeep({...e==null?void 0:e._item,_id:null}))}t(1,i={...i});break;case"edit":ue(e);break}},G={},P=(e,c)=>{e.dataTransfer.setData("index",c==null?void 0:c.i),G.index=c==null?void 0:c.i},_e=(e,c)=>{G.index_dest=c==null?void 0:c.i},$=(e,c)=>{var S,M;try{e.preventDefault();const I=G.index,H=y.cloneDeep((M=(S=i==null?void 0:i.dashboard_conf)==null?void 0:S.items)==null?void 0:M[I]),ie=G.index_dest;i.dashboard_conf.items.splice(I,1),i.dashboard_conf.items.splice(ie,0,y.cloneDeep(H)),t(1,i={...i})}catch(I){t(4,g.open=!0,g),t(4,g.type="error",g),t(4,g.msg=I.message,g)}},Se=e=>{var c,S,M;if(e.data){const I={table:((c=e==null?void 0:e.data)==null?void 0:c.table)||m,permanently:(S=e==null?void 0:e.data)==null?void 0:S.permanently,data:(M=e==null?void 0:e.data)==null?void 0:M.data.map(H=>{var de,Me,je,ze;const ie=(je=(Me=r==null?void 0:r.tables)==null?void 0:Me[((de=e==null?void 0:e.data)==null?void 0:de.table)||m])==null?void 0:je.pk;return{[ie]:H[ie],excluded:!0,_to_delete:!0,permanently:(ze=e==null?void 0:e.data)==null?void 0:ze.permanently}})};I.permanently,J(I)}Q()},he=e=>{var S,M;const c=l.t("crud.del_alert",{len:(S=e==null?void 0:e.data)==null?void 0:S.length,s:((M=e==null?void 0:e.data)==null?void 0:M.length)>1?"s":""});t(5,u.component=null,u),t(5,u.msg=null,u),t(5,u.html_msg=`<span class="m-2 text-lg">${c}</span>`,u),t(5,u.open=!0,u),t(5,u.header=!1,u),t(5,u.data=e,u),t(5,u.actions=[{type:"btn",icon:"ban",name:"NO",class:"btn-sm text-error",label:l.t("crud.no"),action:Q},{type:"btn",icon:"check",name:"YES",class:"btn-sm text-success",label:l.t("crud.yes"),action:Se}],u),t(5,u.width=4,u),t(5,u.heigth=null,u)},te=async e=>{if(e=e||k,!e)t(1,i={dashboard_conf:y.cloneDeep(N)});else if(!e.dashboard_conf)t(1,i={...e,dashboard_conf:y.cloneDeep(N)});else if(typeof e.dashboard_conf=="string"){t(2,p={}),t(7,D={});try{t(1,i={...e,dashboard_conf:JSON.parse(e.dashboard_conf)})}catch{t(1,i={...e,dashboard_conf:y.cloneDeep(N)})}}be(i)};let D={};const be=async e=>{var c,S,M,I,H,ie,de,Me,je,ze,Re,Ce,He,Ke,Ue,We,Ye,Ge,Qe,Xe,Ze,xe,$e,ye,et;try{for(let K=0;K<(((S=(c=e==null?void 0:e.dashboard_conf)==null?void 0:c.items)==null?void 0:S.length)||0);K++){const d=(I=(M=e==null?void 0:e.dashboard_conf)==null?void 0:M.items)==null?void 0:I[K];if((d==null?void 0:d.component)!=="Blank"){(d==null?void 0:d.component)==="Filter"&&(p?Array.isArray(p)&&t(2,p={}):t(2,p={}),p[(H=d==null?void 0:d.options)==null?void 0:H.name]||t(2,p[(ie=d==null?void 0:d.options)==null?void 0:ie.name]=null,p)),e.dashboard_conf.items[K]._id||(e.dashboard_conf.items[K]._id=jt(`item-${d==null?void 0:d.label.replace(" ","_")}`),t(1,i={...i})),e.dashboard_conf.items[K].loading=!0;try{if(((de=d==null?void 0:d.options)==null?void 0:de.type)==="Read"?t(7,D[e.dashboard_conf.items[K]._id]=await ee(d==null?void 0:d.options),D):t(7,D[e.dashboard_conf.items[K]._id]=await X(d),D),(d==null?void 0:d.component)==="Filter"&&!p[(Me=d==null?void 0:d.options)==null?void 0:Me.name]){const Be=(ze=(je=D[e.dashboard_conf.items[K]._id])==null?void 0:je.data)==null?void 0:ze.length;t(2,p[(Re=d==null?void 0:d.options)==null?void 0:Re.name]=(Ue=(He=(Ce=D[e.dashboard_conf.items[K]._id])==null?void 0:Ce.data)==null?void 0:He[0])==null?void 0:Ue[(Ke=d==null?void 0:d.options)==null?void 0:Ke.value_field],p),((We=d==null?void 0:d.options)==null?void 0:We.default)==="last"?t(2,p[(Ye=d==null?void 0:d.options)==null?void 0:Ye.name]=(Ze=(Qe=(Ge=D[e.dashboard_conf.items[K]._id])==null?void 0:Ge.data)==null?void 0:Qe[Be-1])==null?void 0:Ze[(Xe=d==null?void 0:d.options)==null?void 0:Xe.value_field],p):((xe=d==null?void 0:d.options)==null?void 0:xe.default)==="---all"&&t(2,p[($e=d==null?void 0:d.options)==null?void 0:$e.name]=(et=(ye=D[e.dashboard_conf.items[K]._id])==null?void 0:ye.data)==null?void 0:et.map(Pe=>{var tt;return Pe==null?void 0:Pe[(tt=d==null?void 0:d.options)==null?void 0:tt.value_field]}),p)}}catch(Be){t(7,D[e.dashboard_conf.items[K]._id]={success:!1,msg:Be==null?void 0:Be.message},D)}delete e.dashboard_conf.items[K].loading}}}catch(K){console.log(K.message)}};qt(async()=>{l.changeLanguage(r==null?void 0:r.lang),console.log({table:m,data:k,main_table:_,aux_data:o});try{st.locale(r==null?void 0:r.lang)}catch{st.locale("en-us")}te(k),(await Te(()=>import("./DataTable-abed8de9.js"),["assets/DataTable-abed8de9.js","assets/index-8239faad.js","assets/index-72afd4a3.css","assets/pt-4424e41e.js"])).default,(await Te(()=>import("./MiniStat-7363c739.js"),["assets/MiniStat-7363c739.js","assets/index-8239faad.js","assets/index-72afd4a3.css","assets/pt-4424e41e.js"])).default,(await Te(()=>import("./EChartsEngine-496f185d.js"),["assets/EChartsEngine-496f185d.js","assets/index-8239faad.js","assets/index-72afd4a3.css","assets/pt-4424e41e.js","assets/index-d8696fb1.js"])).default});const Ee=()=>{t(3,q=!q)};function C(){i.dashboard_conf.label=this.value,t(1,i),t(7,D)}const L=()=>{t(3,q=!q)},z=()=>{var e;return J({data:{...i,dashboard:(e=k==null?void 0:k.dashboard_conf)==null?void 0:e.label},table:"dashboard"})},B=()=>te(i),T=()=>{he({data:[i],table:"dashboard"})},F=e=>$(e),R=(e,c)=>x({i:e,_item:c,action:"edit"}),ne=(e,c)=>x({i:e,_item:c,action:"delete"}),se=(e,c)=>x({i:e,_item:c,action:"duplicate"});function re(e){var c;p[(c=e==null?void 0:e.options)==null?void 0:c.name]=zt(this),t(2,p),t(7,D),t(1,i)}const v=(e,c,S)=>P(S,{i:e,_item:c}),A=(e,c,S)=>_e(S,{i:e,_item:c}),le=(e,c,S)=>$(S),ge=(e,c,S)=>$(S),we=e=>{t(4,g.open=!1,g)},ke=e=>Q(e.detail);return s.$$set=e=>{"_id"in e&&t(17,f=e._id),"table"in e&&t(18,m=e.table),"data"in e&&t(0,k=e.data),"aux_data"in e&&t(19,o=e.aux_data),"main_table"in e&&t(20,_=e.main_table),"actions"in e&&t(21,a=e.actions),"action"in e&&t(22,h=e.action)},s.$$.update=()=>{s.$$.dirty[0]&4456448&&((h==null?void 0:h.name)==="form_customization"||(h==null?void 0:h.name)==="save"&&(console.log(V,h),J({table:m}))),s.$$.dirty[0]&131072&&(console.log({_id:f}),te())},[k,i,p,q,g,u,Y,D,l,J,Q,x,P,_e,$,he,te,f,m,o,_,a,h,Ee,C,L,z,B,T,F,R,ne,se,re,v,A,le,ge,we,ke]}class Gt extends wt{constructor(n){super(),kt(this,n,Kt,Ct,pt,{_id:17,table:18,data:0,aux_data:19,main_table:20,actions:21,action:22},null,[-1,-1])}}export{Gt as default};
